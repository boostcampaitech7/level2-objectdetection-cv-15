## Ensemble inference

### nms
---
NMS는 객체 탐지에서 가장 기본적이고 널리 사용되는 기법이야. 다수의 예측 박스 중에서 가장 높은 점수를 가진 박스를 선택하고, 그 박스와의 IoU(Intersection over Union)가 특정 임계값을 넘는 나머지 박스들을 제거해. 이 과정을 반복해서 최종 박스들을 남기는 방식이야.

- 작동 방식:

    1. 모든 박스의 confidence score를 기준으로 내림차순 정렬.
    2. 가장 높은 점수를 가진 박스를 선택.
    3. 그 박스와의 IoU가 임계값을 넘는 나머지 박스들을 제거.
    4. 남은 박스에 대해 다시 반복.
- 장점: 단순하고 빠르며, 많은 객체 탐지 모델에서 효과적.
- 단점: IoU 임계값에 민감하고, 겹치는 객체를 잘 처리하지 못할 수 있음.


### soft_nms
---
Soft-NMS는 NMS의 개선된 버전으로, 박스를 완전히 제거하지 않고 점수를 부드럽게 감소시키는 방식이야. 겹치는 박스가 있을 때 IoU에 따라 점수를 줄이고, 제거하는 대신 낮은 점수로 남겨둬. 이런 방식으로 겹치는 객체들을 더 잘 처리할 수 있어.

- 작동 방식: 

    1. NMS와 비슷하게 박스를 정렬하고 가장 높은 점수의 박스를 선택.
    2. 선택된 박스와 겹치는 나머지 박스의 점수를 IoU에 따라 점차 줄여 나감.
    3. 점수가 임계값 이하로 낮아지면 제거.
- 장점: 겹치는 객체를 더 잘 처리함. IoU 임계값에 덜 민감.
- 단점: NMS보다 계산량이 많음.

### non_maximum_weighted
---
Non-Maximum Weighted는 중복되는 박스의 정보를 완전히 버리지 않고, 서로 가중 평균을 계산하여 최종 예측 박스를 생성하는 방식이야. 여러 박스의 위치와 점수를 고려하여 더 정밀한 위치를 추정할 수 있어.

- 작동 방식:


    1. NMS처럼 상위 점수의 박스를 기준으로 하되, IoU가 일정 임계값을 넘는 박스들의 좌표와 점수를 가중치로 계산.
    2. 중복되는 박스를 평균화하여 하나의 박스로 합침.
- 장점: 중복된 정보를 활용해 더 정확한 박스를 생성할 수 있음.
- 단점: 매우 많은 중복 박스가 있을 때 효과가 떨어질 수 있음.


### weighted_boxes_fusion
---
**Weighted Boxes Fusion (WBF)** 는 특히 앙상블 모델에서 자주 사용하는 방법으로, 중복되는 박스들을 가중 평균으로 결합해 최종 예측 박스를 생성해. 중복 박스의 점수와 좌표를 합쳐 보다 정확한 박스 위치를 추정하는 방식이야. 특히 여러 모델의 예측을 앙상블할 때 유용해.

- 작동 방식:


    1. 비슷한 박스들끼리 그룹화하고, 각 박스의 좌표와 confidence score를 기반으로 가중 평균을 구해 최종 박스 좌표를 생성.
    2. 박스의 개수를 줄이지 않고 모든 박스의 정보가 반영된 결과를 출력.
- 장점: 여러 모델을 앙상블하는 상황에서 특히 유용하며, 박스의 좌표를 더 정확하게 추정할 수 있음.
- 단점: 계산량이 많고, 매우 많은 중복 박스가 있을 때 성능이 떨어질 수 있음.

### 사용 방법
---

1. config file 수정
    - data_path: data root 경로
    - csv_paths: 앙상블 할 csv file들의 경로
    - iou_thr: nms IoU threshold 설정
    - save_filename: 새로 저장할 csv file 이름

2. command 실행

    ```bash
    python ensemble_inference.py {config_path} --method={method_name}
    ```